<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pong Online</title>

<style>
* { box-sizing: border-box; }
body {
  margin: 0;
  background: radial-gradient(circle at top, #111, #000);
  color: white;
  font-family: system-ui, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}

h1 {
  margin-top: 20px;
  letter-spacing: 4px;
}

#menu {
  margin-top: 40px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  align-items: center;
}

input {
  padding: 12px;
  font-size: 18px;
  text-align: center;
  width: 160px;
  text-transform: uppercase;
}

button {
  padding: 12px 24px;
  font-size: 18px;
  border: none;
  border-radius: 8px;
  background: white;
  color: black;
}

button:active {
  transform: scale(0.96);
}

canvas {
  margin-top: 20px;
  background: black;
  border: 3px solid white;
  display: none;
}

#controls {
  display: none;
  gap: 40px;
  margin-top: 20px;
}

.control-btn {
  font-size: 28px;
  width: 80px;
  height: 80px;
  border-radius: 50%;
}
</style>
</head>

<body>

<h1>PONG</h1>

<div id="menu">
  <input id="roomInput" placeholder="ROOM CODE" maxlength="5" />
  <button onclick="joinRoom()">PLAY</button>
</div>

<canvas id="game" width="600" height="400"></canvas>

<div id="controls">
  <button class="control-btn" onclick="move(-25)">▲</button>
  <button class="control-btn" onclick="move(25)">▼</button>
</div>

<script>
const WS_URL = "wss://bold-hawk-92.noaheburne-ux.deno.net";

const ws = new WebSocket(WS_URL);
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let side = null;
let paddleY = 150;
let gameState = null;
let started = false;

ws.onmessage = (event) => {
  const msg = JSON.parse(event.data);

  if (msg.type === "joined") {
    side = msg.side;
  }

  if (msg.type === "start") {
    document.getElementById("menu").style.display = "none";
    canvas.style.display = "block";
    document.getElementById("controls").style.display = "flex";
    started = true;
    requestAnimationFrame(draw);
  }

  if (msg.type === "state") {
    gameState = msg;
  }
};

function joinRoom() {
  const room = document.getElementById("roomInput").value.trim().toUpperCase();
  if (!room) return;

  ws.send(JSON.stringify({
    type: "join",
    room
  }));
}

function move(delta) {
  if (!started) return;

  paddleY = Math.max(0, Math.min(300, paddleY + delta));

  ws.send(JSON.stringify({
    type: "move",
    y: paddleY
  }));
}

function draw() {
  if (!gameState) {
    requestAnimationFrame(draw);
    return;
  }

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillRect(20, gameState.players.left, 10, 100);
  ctx.fillRect(570, gameState.players.right, 10, 100);

  ctx.beginPath();
  ctx.arc(gameState.ball.x, gameState.ball.y, 6, 0, Math.PI * 2);
  ctx.fill();

  requestAnimationFrame(draw);
}
</script>

</body>
</html>
